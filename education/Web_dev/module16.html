<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 16 - The Fetch API</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            color: #1a202c;
        }
        .container {
            max-width: 900px;
        }
        .prose h1, .prose h2, .prose h3 {
            color: #3182ce;
        }
        .code-block {
            background-color: #1f2937;
            color: #f9fafb;
            border-radius: 0.5rem;
            padding: 1.5rem;
            overflow-x: auto;
            font-family: monospace;
        }
        .lesson-card {
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }
        .modal-content {
            background-color: #fefefe;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .modal-close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            line-height: 1;
        }
        .modal-close-btn:hover,
        .modal-close-btn:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
        .section-content {
            display: none;
        }
        .section-content.active {
            display: block;
        }
        .tab-button {
            transition: all 0.2s ease-in-out;
        }
        .tab-button.active {
            background-color: #3182ce;
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .lesson-button {
            transition: all 0.2s ease-in-out;
            transform: translateY(0);
        }
        .lesson-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="index.html" class="text-xl font-bold text-gray-900">Module 16: The Fetch API</a>
            <a id="next-module-btn" href="exam.html" class="px-5 py-2 bg-gray-400 text-white font-semibold rounded-full shadow-lg cursor-not-allowed">Proceed to Exam &rarr;</a>
        </div>
    </header>

    <main class="flex-grow container mx-auto px-6 py-10 md:py-16">
        <div class="prose max-w-none">
            <h1 class="text-center text-4xl font-extrabold mb-10 text-gray-900">Final Module: The Fetch API</h1>
            
            <!-- Section 1: Intro to Fetch API -->
            <section class="lesson-card p-8 mb-12">
                <h2 class="text-3xl font-bold mb-4">1. What is the Fetch API?</h2>
                <p class="text-gray-700 mb-4">The **Fetch API** provides a modern, powerful, and flexible interface for fetching resources across the network. It's the standard way to make HTTP requests (like GET, POST, etc.) in the browser and has largely replaced older methods like `XMLHttpRequest`. Fetch returns a `Promise`, which makes it a perfect fit for asynchronous operations.</p>
                <div class="bg-blue-50 border border-blue-200 rounded-2xl p-6 mb-6">
                    <h2 class="text-xl font-bold text-blue-800 mb-2">Live Example: Fetching a Quote</h2>
                    <p id="quote-text" class="text-2xl italic mb-2">Loading a brilliant quote...</p>
                    <p id="quote-author" class="font-semibold text-gray-700"></p>
                </div>
                <button onclick="openQuiz('quiz1')" class="lesson-button mt-6 w-full md:w-auto px-6 py-3 bg-blue-500 text-white font-semibold rounded-lg shadow-md hover:bg-blue-600 transition-colors">
                    Test Your Knowledge
                </button>
            </section>
            
            <!-- Section 2: Fetch and Promises -->
            <section id="section-2" class="lesson-card p-8 mb-12 hidden-section">
                <h2 class="text-3xl font-bold mb-4">2. Using Promises with Fetch</h2>
                <p class="text-gray-700 mb-4">The `fetch()` function returns a `Promise`. You can handle the response using `.then()` for a successful request and `.catch()` for an error. Remember that the first `.then()` block is to check for the HTTP status, and the second `.then()` block is to process the data.</p>
                <pre class="code-block whitespace-pre-wrap"><code class="language-js">fetch('https://api.quotable.io/random')
  .then(response => {
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    return response.json();
  })
  .then(data => {
    // We now have the JSON data!
    console.log(data.content);
  })
  .catch(error => {
    console.error('There was a problem with the fetch operation:', error);
  });</code></pre>
                <button onclick="openQuiz('quiz2')" class="lesson-button mt-6 w-full md:w-auto px-6 py-3 bg-blue-500 text-white font-semibold rounded-lg shadow-md hover:bg-blue-600 transition-colors">
                    Test Your Knowledge
                </button>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white shadow-inner mt-auto">
        <div class="container mx-auto px-6 py-6 text-center text-sm text-gray-500">
            &copy; 2025 WebDev Mastery. All rights reserved.
        </div>
    </footer>

    <!-- Quiz Modal -->
    <div id="quizModal" class="modal">
        <div class="modal-content flex flex-col items-center">
            <span class="modal-close-btn self-end" onclick="closeModal()">&times;</span>
            <p id="quiz-question" class="text-xl font-semibold mb-4 text-gray-800"></p>
            <input id="quiz-answer" type="text" class="w-full border-2 border-gray-300 rounded-lg p-3 mb-4 focus:outline-none focus:border-blue-500" placeholder="Your answer...">
            <p id="quiz-message" class="text-sm text-red-500 mb-4"></p>
            <button onclick="checkAnswer()" class="px-6 py-3 bg-blue-500 text-white font-semibold rounded-lg shadow-md hover:bg-blue-600 transition-colors">
                Submit Answer
            </button>
        </div>
    </div>

    <script>
        const quizData = {
            'quiz1': {
                question: 'What does the Fetch API return that is used to handle asynchronous operations?',
                answer: 'promise'
            },
            'quiz2': {
                question: 'What method do you use after the first `then` block to parse the JSON data from a response?',
                answer: '.json()'
            }
        };

        let currentQuizId = '';
        let quizAttempts = 0;

        async function fetchQuote() {
            try {
                const response = await fetch('https://api.quotable.io/random');
                const data = await response.json();
                document.getElementById('quote-text').textContent = `"${data.content}"`;
                document.getElementById('quote-author').textContent = `- ${data.author}`;
            } catch (error) {
                document.getElementById('quote-text').textContent = "Failed to fetch a quote. Check your network.";
                document.getElementById('quote-author').textContent = "";
                console.error("Error fetching quote:", error);
            }
        }

        function openQuiz(quizId) {
            currentQuizId = quizId;
            quizAttempts = 0;
            const modal = document.getElementById('quizModal');
            document.getElementById('quiz-question').textContent = quizData[quizId].question;
            document.getElementById('quiz-answer').value = '';
            document.getElementById('quiz-message').textContent = '';
            modal.style.display = 'flex';
        }

        function closeModal() {
            const modal = document.getElementById('quizModal');
            modal.style.display = 'none';
        }

        function checkAnswer() {
            const userAnswer = document.getElementById('quiz-answer').value.trim().toLowerCase();
            const correctAnswer = quizData[currentQuizId].answer.toLowerCase();
            const messageElement = document.getElementById('quiz-message');

            if (userAnswer === correctAnswer || (correctAnswer.includes('promise') && userAnswer.includes('prom')) || (correctAnswer.includes('.json()') && userAnswer.includes('json'))) {
                messageElement.textContent = 'Correct! Great job!';
                messageElement.style.color = '#10b981';
                setTimeout(() => {
                    closeModal();
                    unlockNextSection();
                }, 1000);
            } else {
                quizAttempts++;
                if (quizAttempts >= 5) {
                    messageElement.textContent = `Too many tries. The correct answer is: ${quizData[currentQuizId].answer}.`;
                    messageElement.style.color = '#ef4444';
                    setTimeout(() => {
                        closeModal();
                        unlockNextSection();
                    }, 2000);
                } else {
                    messageElement.textContent = `Incorrect. You have ${5 - quizAttempts} tries remaining.`;
                    messageElement.style.color = '#ef4444';
                }
            }
        }

        function unlockNextSection() {
            const currentSectionNumber = parseInt(currentQuizId.replace('quiz', ''));
            const nextSectionNumber = currentSectionNumber + 1;
            const nextSection = document.getElementById(`section-${nextSectionNumber}`);
            
            if (nextSection) {
                nextSection.classList.remove('hidden-section');
            }

            if (currentQuizId === 'quiz2') {
                const nextModuleBtn = document.getElementById('next-module-btn');
                nextModuleBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                nextModuleBtn.classList.add('bg-blue-500', 'hover:bg-blue-600', 'transition-colors');
                nextModuleBtn.style.cursor = 'pointer';
            }
        }

        window.onload = () => {
            fetchQuote();
            document.getElementById('section-2').classList.remove('hidden-section');
        };
    </script>
</body>
</html>
